<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>TaiTools by Prairie Forge</title>

    <!-- Office.js Library -->
    <script type="text/javascript" src="https://appsforoffice.microsoft.com/lib/1/hosted/office.js"></script>

    <!-- Styles -->
    <link rel="stylesheet" href="../Common/styles.css?v=20251210a" />
    <link rel="stylesheet" href="selector.css?v=20251210a" />
</head>

<body>
    <div class="pf-brand-float" aria-hidden="true">
        <span class="pf-brand-wave"></span>
    </div>
    <div class="app-shell">
        <header class="glass-card hero-card">
            <div class="hero-inner">
                <div class="hero-title">
                    <h1 id="heroGreeting">Hello</h1>
                </div>
                <div class="hero-meta">
                    <div class="hero-meta-item">
                        <span class="meta-label">Available Modules</span>
                        <span class="meta-value" id="moduleCount">0</span>
                    </div>
                </div>
                <!-- Quick Access to Reference Data -->
                <div class="quick-access">
                    <span class="quick-access-label">Quick Access</span>
                    <div class="quick-access-buttons">
                        <button type="button" class="quick-access-btn" id="quickRosterBtn" title="Employee Roster">
                            <svg class="quick-access-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/>
                                <circle cx="9" cy="7" r="4"/>
                                <path d="M22 21v-2a4 4 0 0 0-3-3.87"/>
                                <path d="M16 3.13a4 4 0 0 1 0 7.75"/>
                            </svg>
                            <span>Roster</span>
                        </button>
                        <button type="button" class="quick-access-btn" id="quickAccountsBtn" title="Chart of Accounts">
                            <svg class="quick-access-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M4 19.5v-15A2.5 2.5 0 0 1 6.5 2H20v20H6.5a2.5 2.5 0 0 1 0-5H20"/>
                                <path d="M8 7h6"/>
                                <path d="M8 11h8"/>
                            </svg>
                            <span>Accounts</span>
                        </button>
                        <button type="button" class="quick-access-btn" id="quickConfigBtn" title="Configuration">
                            <svg class="quick-access-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <circle cx="12" cy="12" r="3"/>
                                <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 1 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 1 1-4 0v-.09a1.65 1.65 0 0 0-1-1.51 1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 1 1-2.83-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 1 1 0-4h.09a1.65 1.65 0 0 0 1.51-1 1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 1 1 2.83-2.83l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 1 1 4 0v.09a1.65 1.65 0 0 0 1 1.51h.09a1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 1 1 2.83 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9c0 .69.4 1.3 1.01 1.58.16.07.33.12.51.12H21a2 2 0 1 1 0 4h-.09a1.65 1.65 0 0 0-1.51 1Z"/>
                            </svg>
                            <span>Configuration</span>
                        </button>
                    </div>
                </div>
            </div>
        </header>

        <section class="glass-card modules-card">
            <div class="modules-header">
                <h2>Your Modules</h2>
            </div>
            <div class="module-grid" id="moduleGrid"></div>
        </section>

        <section class="glass-card brand-card">
            <div class="brand-text">
                <div class="brand-label">prairie.forge</div>
                <div class="brand-meta">¬© Prairie Forge LLC, 2025. All rights reserved. Version 90bc7eb</div>
                <button type="button" class="admin-link" id="adminLink">Admin</button>
            </div>
        </section>
    </div>

    <!-- Admin Portal (hidden by default) -->
    <div class="admin-overlay" id="adminOverlay" hidden>
        <div class="admin-modal glass-card">
            <!-- Password Gate -->
            <div class="admin-gate" id="adminGate">
                <div class="admin-header">
                    <h2>Admin Access</h2>
                    <button type="button" class="admin-close" id="adminClose">&times;</button>
                </div>
                <div class="admin-body">
                    <p class="admin-subtitle">Enter the admin password to continue.</p>
                    <div class="admin-form">
                        <input type="password" id="adminPassword" class="admin-input" placeholder="Password" autocomplete="off">
                        <button type="button" class="admin-btn" id="adminSubmit">Enter</button>
                    </div>
                    <p class="admin-error" id="adminError" hidden>Incorrect password. Please try again.</p>
                </div>
            </div>

            <!-- Admin Dashboard (shown after auth) -->
            <div class="admin-dashboard" id="adminDashboard" hidden>
                <div class="admin-header">
                    <h2>Admin Portal</h2>
                    <button type="button" class="admin-close" id="adminCloseAuth">&times;</button>
                </div>
                <div class="admin-body">
                    <!-- SETTINGS & TOOLS -->
                    <div class="admin-settings-panel">
                        <!-- Settings Tabs -->
                        <div class="settings-tabs">
                            <button type="button" class="settings-tab active" data-settings="tabs">Tab Management</button>
                            <button type="button" class="settings-tab" data-settings="config">Shared Config</button>
                            <button type="button" class="settings-tab" data-settings="utilities">Utilities</button>
                        </div>

                        <!-- Tab Management -->
                        <div class="settings-content active" id="settings-tabs">
                            <div class="admin-section">
                                <h3>Tab Management</h3>
                                <p class="admin-hint">Manage which Excel tabs belong to each module.</p>
                                
                                <div class="tab-mgmt-filter">
                                    <label class="admin-field admin-field--inline">
                                        <span>Filter by Module:</span>
                                        <select id="tabModuleFilter" class="admin-select">
                                            <option value="">All Modules</option>
                                        </select>
                                    </label>
                                </div>
                                
                                <p class="tab-mgmt-count">Loading tab mappings...</p>
                                <div class="tab-mgmt-list" id="tabMgmtList">
                                    <!-- Populated by JS -->
                                </div>
                                
                                <div class="tab-mgmt-add">
                                    <h4>Add New Tab Mapping</h4>
                                    <div class="tab-mgmt-add-form">
                                        <select id="newTabModule" class="admin-select" required>
                                            <option value="">Select Module...</option>
                                        </select>
                                        <input type="text" id="newTabName" class="admin-input" placeholder="Tab Name (e.g. PR_Data)">
                                        <input type="text" id="newTabFolder" class="admin-input" placeholder="Module Key (e.g. payroll-recorder)" title="Valid: payroll-recorder, pto-accrual, employee-roster, shared, all">
                                        <button type="button" class="admin-btn" id="addTabMappingBtn">Add</button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Shared Config -->
                        <div class="settings-content" id="settings-config" hidden>
                            <div class="admin-section">
                                <h3>Shared Configuration</h3>
                                <p class="admin-hint">These values are shared across all modules.</p>
                                <div class="admin-form-grid">
                                    <label class="admin-field">
                                        <span>Company Name</span>
                                        <input type="text" id="sharedCompanyName" class="admin-input" placeholder="Your Company">
                                    </label>
                                    <label class="admin-field">
                                        <span>Default Reviewer Name</span>
                                        <input type="text" id="sharedReviewerName" class="admin-input" placeholder="Full Name">
                                    </label>
                                    <label class="admin-field">
                                        <span>Accounting Software Link</span>
                                        <input type="url" id="sharedAccountingLink" class="admin-input" placeholder="https://...">
                                    </label>
                                    <label class="admin-field">
                                        <span>Payroll Provider Link</span>
                                        <input type="url" id="sharedPayrollLink" class="admin-input" placeholder="https://...">
                                    </label>
                                </div>
                                <button type="button" class="admin-btn" id="saveSharedConfig">Save Shared Config</button>
                            </div>
                        </div>

                        <!-- Utilities -->
                        <div class="settings-content" id="settings-utilities" hidden>
                            <!-- Workbook Setup Section -->
                            <div class="admin-section">
                                <h3>üìã Workbook Setup</h3>
                                <p class="admin-hint">Initialize a new workbook with all required TaiTools tabs, or repair an existing workbook by adding missing tabs.</p>
                                
                                <div class="workbook-setup-options">
                                    <div class="setup-option">
                                        <h4>Initialize New Workbook</h4>
                                        <p>Creates all 15 required tabs with proper headers and formatting.</p>
                                        <div class="setup-module-select">
                                            <label class="admin-field admin-field--inline">
                                                <span>Module:</span>
                                                <select id="initModuleSelect" class="admin-select">
                                                    <option value="all">All Modules</option>
                                                    <option value="payroll">Payroll Recorder Only</option>
                                                    <option value="pto">PTO Accrual Only</option>
                                                    <option value="shared">Shared Tabs Only</option>
                                                </select>
                                            </label>
                                        </div>
                                        <button type="button" class="admin-btn admin-btn--primary" id="initWorkbookBtn">
                                            üöÄ Initialize Workbook
                                        </button>
                                    </div>
                                    
                                    <div class="setup-option">
                                        <h4>Validate & Repair</h4>
                                        <p>Check for missing tabs and create them if needed.</p>
                                        <button type="button" class="admin-btn admin-btn--secondary" id="validateWorkbookBtn">
                                            üîç Validate Structure
                                        </button>
                                        <button type="button" class="admin-btn admin-btn--secondary" id="repairWorkbookBtn">
                                            üîß Repair Missing Tabs
                                        </button>
                                    </div>
                                </div>
                                
                                <!-- Progress Display -->
                                <div class="workbook-setup-progress" id="workbookSetupProgress" hidden>
                                    <div class="progress-bar">
                                        <div class="progress-fill" id="workbookProgressFill"></div>
                                    </div>
                                    <p class="progress-text" id="workbookProgressText">Initializing...</p>
                                </div>
                                
                                <!-- Results Display -->
                                <div class="workbook-setup-results" id="workbookSetupResults" hidden>
                                    <h4>Results</h4>
                                    <div class="setup-results-content" id="setupResultsContent"></div>
                                </div>
                            </div>
                            
                            <hr class="admin-divider">
                            
                            <!-- Other Utilities -->
                            <div class="admin-section">
                                <h3>üõ†Ô∏è Other Utilities</h3>
                                <div class="admin-utilities">
                                    <button type="button" class="admin-btn admin-btn--secondary" id="validateConfigBtn">Validate Config</button>
                                    <button type="button" class="admin-btn admin-btn--secondary" id="generateFieldsBtn">Generate All Fields</button>
                                    <button type="button" class="admin-btn admin-btn--secondary" id="exportConfigBtn">Export Config</button>
                                </div>
                                <div class="admin-log" id="adminLog">
                                    <p class="admin-log-placeholder">Utility output will appear here...</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Reference Data Modal -->
    <div class="ref-data-overlay" id="refDataOverlay" hidden>
        <div class="ref-data-modal">
            <div class="ref-data-header">
                <h2 id="refDataTitle">Reference Data</h2>
                <button type="button" class="ref-data-close" id="refDataClose">&times;</button>
            </div>
            <div class="ref-data-body">
                <!-- View Mode -->
                <div class="ref-data-view-mode" id="refDataViewMode">
                    <!-- Summary Stats -->
                    <div class="ref-data-summary">
                        <div class="ref-data-stat">
                            <span class="ref-data-stat-value" id="refDataRowCount">0</span>
                            <span class="ref-data-stat-label">Records</span>
                        </div>
                        <div class="ref-data-stat">
                            <span class="ref-data-stat-value" id="refDataLastUpdated">‚Äî</span>
                            <span class="ref-data-stat-label">Last Updated</span>
                        </div>
                    </div>
                    
                    <!-- Sheet Status -->
                    <div class="ref-data-sheet-status" id="refDataSheetStatus">
                        <span class="ref-data-sheet-name" id="refDataSheetName">SS_Employee_Roster</span>
                        <span class="ref-data-sheet-badge" id="refDataSheetBadge">Ready</span>
                    </div>
                    
                    <!-- Action Buttons -->
                    <div class="ref-data-actions">
                        <button type="button" class="ref-data-btn ref-data-btn--primary" id="refDataEditBtn">
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z"/>
                                <path d="m15 5 4 4"/>
                            </svg>
                            Make Changes
                        </button>
                        <button type="button" class="ref-data-btn ref-data-btn--secondary" id="refDataOpenSheet">
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"/>
                                <polyline points="15 3 21 3 21 9"/>
                                <line x1="10" x2="21" y1="14" y2="3"/>
                            </svg>
                            Open in Excel
                        </button>
                    </div>
                    
                    <!-- Empty/Loading States -->
                    <div class="ref-data-empty" id="refDataEmpty" hidden>
                        <p>Sheet not found</p>
                        <button type="button" class="ref-data-btn ref-data-btn--primary" onclick="createRefDataSheet()">Create Sheet</button>
                    </div>
                    <div class="ref-data-loading" id="refDataLoading" hidden>
                        <p>Loading...</p>
                    </div>
                </div>
                
                <!-- Edit Mode -->
                <div class="ref-data-edit-mode" id="refDataEditMode" hidden>
                    <!-- Edit Type Selection -->
                    <div class="edit-type-selection" id="editTypeSelection">
                        <p class="edit-prompt">How would you like to make changes?</p>
                        <div class="edit-type-buttons">
                            <button type="button" class="edit-type-btn" id="editTypeQuick">
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z"/>
                                </svg>
                                <span class="edit-type-title">Quick Edit</span>
                                <span class="edit-type-desc">One-off changes to individual records</span>
                            </button>
                            <button type="button" class="edit-type-btn" id="editTypeBulk">
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                                    <polyline points="17 8 12 3 7 8"/>
                                    <line x1="12" x2="12" y1="3" y2="15"/>
                                </svg>
                                <span class="edit-type-title">Bulk Upload</span>
                                <span class="edit-type-desc">Replace from CSV/Excel file</span>
                            </button>
                        </div>
                        <button type="button" class="edit-back-btn" id="editBackToView">‚Üê Back to View</button>
                    </div>
                    
                    <!-- Quick Edit Panel (Employee) -->
                    <div class="quick-edit-panel" id="quickEditEmployee" hidden>
                        <div class="quick-edit-header">
                            <button type="button" class="edit-back-btn" id="quickEditBackEmployee">‚Üê Back</button>
                            <h3>Quick Edit: Employee Roster</h3>
                        </div>
                        <div class="quick-edit-actions">
                            <button type="button" class="quick-action-btn" data-action="add">
                                <span class="quick-action-icon">‚ûï</span>
                                <span>Add Employee</span>
                            </button>
                            <button type="button" class="quick-action-btn" data-action="terminate">
                                <span class="quick-action-icon">‚ûñ</span>
                                <span>Terminate</span>
                            </button>
                            <button type="button" class="quick-action-btn" data-action="transfer">
                                <span class="quick-action-icon">üîÑ</span>
                                <span>Transfer</span>
                            </button>
                            <button type="button" class="quick-action-btn" data-action="edit">
                                <span class="quick-action-icon">‚úèÔ∏è</span>
                                <span>Edit Details</span>
                            </button>
                        </div>
                        <div class="quick-edit-form" id="quickEditFormEmployee">
                            <!-- Form fields populated by JS based on action -->
                        </div>
                        <div class="quick-edit-preview" id="quickEditPreviewEmployee" hidden>
                            <!-- Preview populated by JS -->
                        </div>
                        <div class="quick-edit-buttons" id="quickEditButtonsEmployee" hidden>
                            <button type="button" class="admin-btn admin-btn--secondary" id="quickEditCancelEmployee">Cancel</button>
                            <button type="button" class="admin-btn" id="quickEditConfirmEmployee">Confirm Change</button>
                        </div>
                    </div>
                    
                    <!-- Quick Edit Panel (GL/Accounts) -->
                    <div class="quick-edit-panel" id="quickEditAccounts" hidden>
                        <div class="quick-edit-header">
                            <button type="button" class="edit-back-btn" id="quickEditBackAccounts">‚Üê Back</button>
                            <h3>Quick Edit: Chart of Accounts</h3>
                        </div>
                        <div class="quick-edit-actions">
                            <button type="button" class="quick-action-btn" data-action="add">
                                <span class="quick-action-icon">‚ûï</span>
                                <span>Add Account</span>
                            </button>
                            <button type="button" class="quick-action-btn" data-action="delete">
                                <span class="quick-action-icon">‚ûñ</span>
                                <span>Delete Account</span>
                            </button>
                            <button type="button" class="quick-action-btn" data-action="rename">
                                <span class="quick-action-icon">‚úèÔ∏è</span>
                                <span>Rename</span>
                            </button>
                            <button type="button" class="quick-action-btn" data-action="renumber">
                                <span class="quick-action-icon">#Ô∏è‚É£</span>
                                <span>Change Number</span>
                            </button>
                        </div>
                        <div class="quick-edit-form" id="quickEditFormAccounts">
                            <!-- Form fields populated by JS based on action -->
                        </div>
                        <div class="quick-edit-preview" id="quickEditPreviewAccounts" hidden>
                            <!-- Preview populated by JS -->
                        </div>
                        <div class="quick-edit-buttons" id="quickEditButtonsAccounts" hidden>
                            <button type="button" class="admin-btn admin-btn--secondary" id="quickEditCancelAccounts">Cancel</button>
                            <button type="button" class="admin-btn" id="quickEditConfirmAccounts">Confirm Change</button>
                        </div>
                    </div>
                    
                    <!-- Bulk Upload Panel -->
                    <div class="bulk-upload-panel" id="bulkUploadPanel" hidden>
                        <div class="quick-edit-header">
                            <button type="button" class="edit-back-btn" id="bulkUploadBack">‚Üê Back</button>
                            <h3 id="bulkUploadTitle">Bulk Upload</h3>
                        </div>
                        <div class="bulk-upload-dropzone" id="bulkUploadDropzone">
                            <input type="file" id="bulkUploadFile" accept=".csv,.xlsx,.xls" hidden>
                            <div class="upload-icon">üìÅ</div>
                            <p class="upload-text">Drop CSV or Excel file here</p>
                            <p class="upload-hint">or click to browse</p>
                        </div>
                        <div class="bulk-upload-file-info" id="bulkUploadFileInfo" hidden>
                            <span class="file-icon">üìÑ</span>
                            <span class="file-name" id="bulkUploadFileName">‚Äî</span>
                            <span class="file-rows" id="bulkUploadFileRows">0 rows</span>
                            <button type="button" class="file-remove" id="bulkUploadFileRemove">√ó</button>
                        </div>
                        <div class="bulk-upload-comparison" id="bulkUploadComparison" hidden>
                            <h4>Comparison Results</h4>
                            <div class="comparison-results" id="comparisonResults">
                                <!-- Populated by JS -->
                            </div>
                        </div>
                        <div class="bulk-upload-warning" id="bulkUploadWarning" hidden>
                            <p>‚ö†Ô∏è <span id="bulkUploadWarningText">This will replace all current data.</span></p>
                        </div>
                        <div class="bulk-upload-buttons" id="bulkUploadButtons" hidden>
                            <button type="button" class="admin-btn admin-btn--secondary" id="bulkUploadCancel">Cancel</button>
                            <button type="button" class="admin-btn admin-btn--danger" id="bulkUploadConfirm">Confirm & Replace All</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Common utilities (PrairieForge namespace) -->
    <script src="../Common/common.js"></script>
    
    <!-- Application script -->
    <script type="module" src="selector.js?v=20251210a"></script>
</body>
</html>
